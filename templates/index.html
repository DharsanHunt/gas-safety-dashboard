<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gas Safety Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --safe:#16a34a;
 --danger:#dc2626;
 --primary:#2563eb;
 --bg:#f4f6f9;
 --card:#ffffff;
 --text:#0f172a;
 --muted:#64748b;
}

*{box-sizing:border-box}

body{
 margin:0;
 font-family:Inter,system-ui;
 background:var(--bg);
 padding:28px;
 color:var(--text);
}

.container{max-width:1400px;margin:auto}

header{
 background:var(--card);
 padding:22px 28px;
 border-radius:14px;
 box-shadow:0 6px 20px rgba(0,0,0,.04);
 margin-bottom:22px;
}

h1{font-size:1.6rem;font-weight:700}

.alert-banner{
 background:var(--card);
 padding:20px 26px;
 border-radius:14px;
 margin-bottom:22px;
 display:flex;
 flex-direction:column;
 gap:6px;
 border-left:6px solid var(--safe);
 transition:.35s ease;
 box-shadow:0 6px 20px rgba(0,0,0,.04);
}

.alert-banner.danger{border-color:var(--danger)}

.metrics-grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
 gap:18px;
 margin-bottom:22px;
}

.metric-card{
 background:var(--card);
 padding:22px;
 border-radius:14px;
 box-shadow:0 6px 20px rgba(0,0,0,.04);
 transition:.3s ease;
}

.metric-card:hover{
 transform:translateY(-3px);
}

.metric-value{
 font-size:2.1rem;
 font-weight:700;
 margin-bottom:6px;
}

.status{
 display:flex;
 align-items:center;
 gap:8px;
 color:var(--muted);
 font-size:.95rem;
}

.status-dot{
 width:10px;
 height:10px;
 border-radius:50%;
 background:var(--safe);
 transition:.3s;
}

.status-dot.danger{background:var(--danger)}

.stats-panel{
 background:var(--card);
 padding:22px;
 border-radius:14px;
 margin-bottom:22px;
 box-shadow:0 6px 20px rgba(0,0,0,.04);
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
 gap:16px;
}

.stat{
 display:flex;
 flex-direction:column;
 gap:4px;
}

.stat span{color:var(--muted);font-size:.85rem}

.chart-section{
 background:var(--card);
 padding:26px;
 border-radius:14px;
 box-shadow:0 6px 20px rgba(0,0,0,.04);
}

.chart-container{height:360px}

.footer{
 margin-top:22px;
 background:var(--card);
 padding:16px;
 border-radius:14px;
 text-align:center;
 color:var(--muted);
 box-shadow:0 6px 20px rgba(0,0,0,.04);
}

/* Smooth number transition */
.fade{
 animation:fadeUp .35s ease;
}

@keyframes fadeUp{
 from{opacity:0;transform:translateY(6px)}
 to{opacity:1;transform:translateY(0)}
}
</style>
</head>

<body>
<div class="container">

<header>
<h1>Gas Safety Monitoring</h1>
</header>

<div id="alertBanner" class="alert-banner">
<h2 id="alertTitle">System Normal</h2>
<p id="alertMessage">All gas levels within safe range</p>
</div>

<div class="metrics-grid">

<div class="metric-card">
<div class="metric-value" id="gas">--</div>
<div class="status">
<div id="statusDot" class="status-dot"></div>
<span id="state">--</span>
</div>
</div>

<div class="metric-card">
<div class="metric-value">2000</div>
<span>Safety Threshold (ppm)</span>
</div>

<div class="metric-card">
<div class="metric-value" id="time">--</div>
<span>Last Updated</span>
</div>

</div>

<div class="stats-panel">
<div class="stat"><strong id="avgLevel">--</strong><span>Average</span></div>
<div class="stat"><strong id="peakLevel">--</strong><span>Peak</span></div>
<div class="stat"><strong id="minLevel">--</strong><span>Minimum</span></div>
<div class="stat"><strong id="dataPoints">0</strong><span>Samples</span></div>
</div>

<div class="chart-section">
<div class="chart-container">
<canvas id="gasChart"></canvas>
</div>
</div>

<div class="footer">Live Industrial Monitoring System</div>

</div>

<script>
const GAS_THRESHOLD=2000
const MAX_POINTS=30
const SMOOTH_WINDOW=5

let labels=[],rawGas=[],smoothGas=[],thresholdData=[]
let stats={sum:0,count:0,peak:0,min:Infinity}

function smooth(d,w){
 if(d.length<w) return d.at(-1)
 return Math.round(d.slice(-w).reduce((a,b)=>a+b)/w)
}

function animate(el){
 el.classList.remove("fade")
 void el.offsetWidth
 el.classList.add("fade")
}

function updateStats(v){
 stats.sum+=v
 stats.count++
 stats.peak=Math.max(stats.peak,v)
 stats.min=Math.min(stats.min,v)

 avgLevel.innerText=Math.round(stats.sum/stats.count)
 peakLevel.innerText=stats.peak
 minLevel.innerText=stats.min
 dataPoints.innerText=stats.count

 animate(avgLevel)
 animate(peakLevel)
 animate(minLevel)
}

const chart=new Chart(gasChart,{
 type:"line",
 data:{
  labels,
  datasets:[
   {
    label:"Gas Level",
    data:smoothGas,
    borderColor:"#2563eb",
    backgroundColor:"rgba(37,99,235,.08)",
    tension:.45,
    fill:true,
    pointRadius:3
   },
   {
    label:"Threshold",
    data:thresholdData,
    borderColor:"#dc2626",
    borderDash:[8,6],
    pointRadius:0
   }
  ]
 },
 options:{
  responsive:true,
  maintainAspectRatio:false,
  animation:{duration:600,easing:"easeOutQuart"},
  scales:{
   y:{min:600,max:2500}
  }
 }
})

async function updateData(){
 const r=await fetch("/data",{cache:"no-store"})
 const d=await r.json()

 gas.innerText=d.gas
 time.innerText=d.time
 state.innerText=d.state
 animate(gas)

 updateStats(d.gas)

 if(d.gas>GAS_THRESHOLD){
  alertBanner.classList.add("danger")
  alertTitle.innerText="Gas Level Critical"
  alertMessage.innerText="Immediate action required"
  statusDot.classList.add("danger")
 }else{
  alertBanner.classList.remove("danger")
  alertTitle.innerText="System Normal"
  alertMessage.innerText="All parameters safe"
  statusDot.classList.remove("danger")
 }

 rawGas.push(d.gas)
 labels.push(d.time)
 smoothGas.push(smooth(rawGas,SMOOTH_WINDOW))
 thresholdData.push(GAS_THRESHOLD)

 if(labels.length>MAX_POINTS){
  labels.shift()
  smoothGas.shift()
  thresholdData.shift()
 }

 chart.update()
}

setInterval(updateData,1000)
updateData()
</script>

</body>
</html>
